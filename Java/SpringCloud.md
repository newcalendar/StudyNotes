# SpringCloud

1、集中式架构

当网站流量很小时，只需要一个应用，将所有功能都部署到一起，以减少部署节点和成本

优点:系统开发速度快、维护成本低、适用于并发要求比较低的系统

缺点：代码耦合度高，后期维护困难，无法针对不同模块进行针对性优化，无法水平扩展，单点容错率低，并发能力差

2、垂直拆分

当访问量逐渐增大，单一应用无法满足需求，此时为了应对更高的并发和业务需求，我们根据业务功能对系统进行拆分

优点：系统拆分实现了流量分担，解决了并发问题，可以针对不同模块进行优化，方便水平扩展，负债均衡，容错率提高

3、分布式服务

当垂直应用越来越多，应用之间交互不可避免，将核心业务抽取出来作为独立的服务，逐渐形成稳定的服务中心，使得前端应用能更快速的响应多变的市场需求

优点：将基础服务进行抽取，系统间相互调用，提高了代码复用和开发效率

缺点：系统间耦合度变高，调用关系错综复杂，难以维护

4、面向服务架构（SOA）

SOA面向服务架构，它是一种设计方法，其中包含了多个服务，服务之间通过相互依赖最终提供了一系列的功能。一个服务通常以独立的形式存在与操作系统进程中。各个服务之间通过网络调用

缺点：每个供应商提供的ESB产品有偏差，自身实现较为复杂，应用服务粒度较大，ESB集成整合所有服务和协议，数据转换使得运维、测试部署困难。所有服务通过一个通路通信，直接降低了通信速度。

5、微服务架构

微服务架构是使用一套小服务来开发单个应用的方式或途径，每个服务基于单一业务能力构建，运行在自己的进程中，并使用轻量级机制通信，通常是HTTP API，并能够通过自动化部署机制来独立部署。这些服务可以使不同的编程语言来实现，以及不同数据存储技术，并保持最低限度的集中式管理

##### 特点：微服务的特点是单一职责，微服务中每个服务都对应唯一的业务能力，做到单一职责

微，微服务的服务拆分粒度很小，例如一个用户管理就可以作为一个服务，每个服务虽小都五脏俱全

面向服务，面向服务是说每个服务都要对外暴露Rest风格服务接口API，并不关系服务的技术实现做到和语言无关，也不限定用很忙技术实现，只要提供Rest的接口即可

##### 服务调用

无论是微服务还是SOA都面临这服务间的远程调用，常见的远程调用方式有，RPC、HTTP

RPC即Remote Produce Call远程调用，RPC基于Socket，工作在会话层，自定义数据格式，速度快，效率高，早期的webservice，现在的dubbo都是RPC的代表

http：http是一种网络传输协议，基于TCP，工作在应用层，规定了数据传输的格式，

## SpringCloud

springcloud的主要涉及组件包括:Eureka(注册中心)、Zuul、Gateway服务网关、Feign服务调用、Hystrix熔断器

#### Eureka注册中心

Eureka为注册中心，实现服务的自动注册、服务发现、状态监控（心跳机制），Eureka是服务注册中心，对外暴露自己的地址，服务提供者将自己在Eureka进行注册，消费者，向Eureka订阅服务，Eureka将对应服务的所有提供者地址列表发送给消费者，并定期更新，通过心跳机制判断服务状态

#### Hystrix熔断器

熔断器是微服务系统中是一款提供保护机制的组件，延迟和容错库，第三方库，防止出现级联失败，Hystrix的熔断机制，可以实现弹性容错，当服务请求情况好转之后可以自动重连，通过断路的方式，将后续请求直接拒绝，一段时间之后允许部分请求通过，如果调用成功则回到断路器关闭状态，否则继续打开，拒绝请求的服务。

雪崩问题，微服务中，服务间调用关系错综复杂，一个请求可能需要调用多个微服务接口才能实现，会形成复杂的调用链路，某个服务异常可能导致其它服务出现异常或者阻塞，然后越来越多的服务出现问题

线程隔离和服务降级：熔断器为每个依赖服务调用分配一个小的线程池，如果线程池已满调用，将被立即拒绝，默认不采用排队，加速失败判定时间，用户的请求将不再直接访问服务，而是通过线程池中的空闲线程来访问服务，如果线程池已满，或者请求超时，则会进行降级处理，服务降级即优先保证核心服务，而非核心服务不可用或弱可用

## Feign

feign的作用是实现代码中调用服务，Feign负载均衡及熔断，可以配置Feign内置ribbon配置项和Hystrix熔断的Fallback配置

### SpringCloud Gateway网关简介

SpringCloud Gateway网关的作用，SPringCloud Gateway核心是一系列过滤器，可以将客户端的请求转发到不同的微服务中去，主要作用：过滤和路由

### SpringCloud config配置中心 

此作用是，可以通过配置中心将配置文件上传到git仓库中进行统一管理，也方便后续的维护修改